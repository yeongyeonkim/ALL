https://grafana.com/docs/alloy/latest/set-up/install/kubernetes/


alloy configmap 설정

https://grafana.com/docs/alloy/latest/tutorials/send-logs-to-loki/


Alloy는 HCL 언어 형식으로 개발된다고 한다.

따라서 아래와 같이 데이터 수집을 위해 local.file_match로 path를 지정하고나면, output으로 target이 생긴다.
(https://grafana.com/docs/alloy/latest/reference/components/local/local.file_match/#exported-fields)

local.file_match "local_files" {
    path_targets = [{
		"__path__" = "/var/log/containers/*.log",
		"__path_exclude__" = "/var/log/containers/cloudwatch-agent*"
	}]
    sync_period = "5s"
}

위에서 생긴 target으로부터 log를 scrape 한다.

loki.source.file "log_scrape" {
	targets    = local.file_match.local_files.targets
	forward_to = [loki.process.filter_logs.receiver]
	tail_from_end = true
}

local.file_match "local_files" {
    path_targets = [{"__path__" = "/var/log/*.log"}]
    sync_period = "5s"
}
 
 
        Exclude_Path        /var/log/containers/cloudwatch-agent*, /var/log/containers/fluent-bit*, /var/log/containers/aws-node*, /var/log/containers/kube-proxy*
        Path                /var/log/containers/*.log