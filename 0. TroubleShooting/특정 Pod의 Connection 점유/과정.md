# 아직 작성되지 않은 문서

### 이슈 발생
SQL Error: 0, SQLState: null --  
HikariPool-1 - Connection is not available, request timed out after 5000ms. --  

-> 원인 분석 시, 특정 Pod에서 Connection이 과하게 몰려있어
해당 Pod에서만 API 에러가 발생함.

### 개선 포인트

1. 문제가 발생했을 때, 자동으로 조치하는 환경을 구성한다.?

 - Liveness에 DB를 바라보도록해서 문제가 발생하는 경우, 컨테이너 재기동될 수 있도록 한다.
  > 하지만, 이게 모든 원인의 해결 방법이 되진 않고 무엇보다 이 경우 자동으로 조치가 되면 1. 우리가 장애를 인지할 수 없을 수도 있다. 조치도 좋지만 인지는 해야하기 때문. 2. 재기동하는 경우, TCP DUMP를 통한 상세한 분석이 어려울 수 있다. 미리 백업을 뜨는 방법을 생각해야할듯

### Java 컨테이너 비정상 시, TCP Dump를 뜨는 방법

 - Pre Stop
 - Shell script
 - istio (sidecar)
 - etc..

※ 선 확인 필요 사항
-> TCP DUMP를 구동할 때, Java 프로세스에 영향을 줄 수 있기 때문에
문제가 발생한 시점이 아니면 주기적으로 dump를 뜨는 것은 좋지 않을 것 같음.
-> 크기 확인 필요

### TCP Dump를 외부에서 확인하기 좋게 환경 혹은 서비스를 구성

 - PV,PVC 사용
 - object storage (TCP DUMP 구성하면서 $ aws s3 cp 명령어로 바로 전송)
 - fluentbit과 연동
 - istio sidecar 활용